# 보안 가이드

## 관리자 페이지 보안 설정

### 필수 환경변수

프로덕션 환경에서는 다음 환경변수를 **반드시** 설정해야 합니다:

1. **`SESSION_SECRET`** (필수)
   - 세션 토큰 서명에 사용되는 비밀키
   - 최소 32자 이상의 랜덤 문자열 권장
   - 예시: `openssl rand -hex 32`로 생성

2. **`ADMIN_PASSWORD_HASH`** (필수)
   - 관리자 비밀번호의 bcrypt 해시
   - 생성 방법:
     ```bash
     node scripts/generate-admin-password-hash.js <원하는비밀번호>
     ```
   - 출력된 해시를 환경변수에 설정

### 보안 개선 사항

#### ✅ 적용된 보안 기능

1. **환경변수 필수화**
   - 기본 비밀번호 제거
   - 환경변수 미설정 시 명확한 에러 메시지

2. **비밀번호 해싱**
   - bcrypt를 사용한 안전한 비밀번호 저장
   - 평문 비밀번호 저장 금지

3. **강력한 세션 토큰**
   - `crypto.randomBytes` 사용 (암호학적으로 안전)
   - HMAC 서명으로 변조 방지
   - 24시간 자동 만료

4. **서버 측 인증 미들웨어**
   - 모든 관리자 API 라우트 보호
   - 클라이언트 측 우회 불가능

5. **Rate Limiting**
   - 로그인 시도: 15분에 5회 제한
   - 무차별 대입 공격 방지

6. **보안 쿠키 설정**
   - `httpOnly`: JavaScript 접근 차단
   - `secure`: HTTPS에서만 전송 (프로덕션)
   - `sameSite: lax`: CSRF 방지

### 초기 설정 가이드

1. **비밀번호 해시 생성**
   ```bash
   node scripts/generate-admin-password-hash.js yourSecurePassword
   ```

2. **Cloudtype 환경변수 설정**
   - `SESSION_SECRET`: 랜덤 문자열 (최소 32자)
   - `ADMIN_PASSWORD_HASH`: 위에서 생성한 해시

3. **테스트**
   - `/admin` 접속
   - 생성한 비밀번호로 로그인 확인

### 보안 권장사항

1. **정기적인 비밀번호 변경**
   - 최소 3개월마다 변경 권장
   - 강력한 비밀번호 사용 (최소 12자, 대소문자/숫자/특수문자 포함)

2. **세션 관리**
   - 사용 후 로그아웃
   - 공용 컴퓨터에서는 사용 금지

3. **모니터링**
   - 로그인 실패 시도 모니터링
   - 의심스러운 활동 감지 시 즉시 비밀번호 변경

4. **추가 보안 (선택사항)**
   - 2FA (2단계 인증) 구현
   - IP 화이트리스트
   - Redis 기반 Rate Limiting (대규모 트래픽 대응)

### 개발 환경

개발 환경에서는 환경변수가 없어도 기본 비밀번호로 동작하지만, 경고 메시지가 표시됩니다.
프로덕션 환경에서는 반드시 환경변수를 설정해야 합니다.
